<!DOCTYPE html>
<html lang="en">
  <head>
    <title>RubyBlogStarterKit</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_include_tag "application", "data-turbo-track": "reload", type: "module" %>
    <%= yield :head %>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const logoImage = document.getElementById('logo-image');

        function setTheme(isDark) {
          if (isDark) {
            document.documentElement.classList.add('dark');
            logoImage.src = '<%= asset_path('logo.svg') %>';
          } else {
            document.documentElement.classList.remove('dark');
            logoImage.src = '<%= asset_path('logo.png') %>';
          }
        }

        // Check for saved theme preference or use default (light)
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
          setTheme(true);
        } else {
          setTheme(false);
        }

        darkModeToggle.addEventListener('click', function() {
          if (document.documentElement.classList.contains('dark')) {
            localStorage.theme = 'light';
            setTheme(false);
          } else {
            localStorage.theme = 'dark';
            setTheme(true);
          }
        });
      });
    </script>
  </head>
  <body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-200">
    <div class="container mx-auto px-4 py-8 relative">
      <div class="absolute top-4 right-4">
        <button id="dark-mode-toggle" class="p-2 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
          </svg>
        </button>
      </div>
      <% if notice %>
        <div class="bg-green-100 dark:bg-green-800 border border-green-400 dark:border-green-700 text-green-700 dark:text-green-200 px-4 py-3 rounded relative mb-4">
          <%= notice %>
        </div>
      <% end %>
      <% if alert %>
        <div class="bg-red-100 dark:bg-red-800 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-200 px-4 py-3 rounded relative mb-4">
          <%= alert %>
        </div>
      <% end %>
      <div class="mt-8 mb-8">
        <%= image_tag "logo.png", id: "logo-image", class: "mx-auto h-12 w-auto", alt: "SARAL Logo" %>
      </div>
      <%= yield %>
      <% if user_signed_in? %>
        <div class="mt-8 text-gray-600 dark:text-gray-400">
          Logged in as <strong class="font-semibold"><%= current_user.email %></strong>.
          <%= button_to 'Logout', destroy_user_session_path, method: :delete, class: "mt-2 bg-red-500 hover:bg-red-700 dark:bg-red-700 dark:hover:bg-red-600 text-white font-bold py-2 px-4 rounded" %>
        </div>
      <% end %>
    </div>
  </body>
</html>
