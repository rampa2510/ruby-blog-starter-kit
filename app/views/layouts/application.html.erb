<!DOCTYPE html>
<html lang="en">
<head>
  <title>RubyBlogStarterKit</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>
  <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
  <%= javascript_include_tag "application", "data-turbo-track": "reload", type: "module" %>
  <%= yield :head %>
  <script>

    function setInitialTheme() {
      if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
    }

    function toggleDarkMode() {
      if (document.documentElement.classList.contains('dark')) {
        document.documentElement.classList.remove('dark');
        localStorage.theme = 'light';
      } else {
        document.documentElement.classList.add('dark');
        localStorage.theme = 'dark';
      }
    }

    // Set initial theme immediately
    setInitialTheme();

    // Add event listener after DOM is loaded
    function addToggleListener() {
      const toggleButton = document.getElementById('darkModeToggle');
      if (toggleButton) {
        toggleButton.addEventListener('click', toggleDarkMode);
      }
    }

    // Try to add listener immediately
    addToggleListener();

    // If the button wasn't found, try again after DOM is fully loaded
    document.addEventListener('DOMContentLoaded', addToggleListener);

    // If using Turbo, also listen for turbo:load event
    document.addEventListener('turbo:load', addToggleListener);
  </script>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100">
  <div class="container mx-auto px-4">
    <div class="fixed top-0 right-0 m-4 z-50">
      <button id="darkModeToggle" class="bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 px-4 py-2 rounded-md">
        <span class="dark:hidden">üåô</span>
        <span class="hidden dark:inline">‚òÄÔ∏è</span>
      </button>
    </div>

    <div class="pt-16 mb-8">
      <%= image_tag "logo-light.svg", class: "mx-auto h-12 w-auto block dark:hidden", alt: "SARAL Logo (Light Mode)" %>
      <%= image_tag "logo.svg", class: "mx-auto h-12 w-auto hidden dark:block", alt: "SARAL Logo (Dark Mode)" %>
    </div>

    <%= yield %>

    <% if user_signed_in? %>
      <div class="mt-4 text-gray-600 dark:text-gray-400">
        Logged in as <strong class="font-semibold"><%= current_user.email %></strong>.
        <%= button_to 'Logout', destroy_user_session_path, method: :delete, class: "mt-2 bg-red-500 hover:bg-red-700 dark:bg-red-700 dark:hover:bg-red-800 text-white font-bold py-2 px-4 rounded" %>
      </div>
    <% end %>
  </div>
</body>
</html>
